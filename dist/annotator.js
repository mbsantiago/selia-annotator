var annotator=function(e){var t={};function a(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,a),i.l=!0,i.exports}return a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(s,i,function(t){return e[t]}.bind(null,i));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=3)}([function(e,t,a){"use strict";e.exports=a(1)},function(e,t,a){"use strict";
/** @license React v16.9.0
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s=a(2),i="function"==typeof Symbol&&Symbol.for,n=i?Symbol.for("react.element"):60103,r=i?Symbol.for("react.portal"):60106,o=i?Symbol.for("react.fragment"):60107,l=i?Symbol.for("react.strict_mode"):60108,c=i?Symbol.for("react.profiler"):60114,m=i?Symbol.for("react.provider"):60109,u=i?Symbol.for("react.context"):60110,h=i?Symbol.for("react.forward_ref"):60112,d=i?Symbol.for("react.suspense"):60113,_=i?Symbol.for("react.suspense_list"):60120,f=i?Symbol.for("react.memo"):60115,p=i?Symbol.for("react.lazy"):60116;i&&Symbol.for("react.fundamental"),i&&Symbol.for("react.responder");var N="function"==typeof Symbol&&Symbol.iterator;function v(e){for(var t=e.message,a="https://reactjs.org/docs/error-decoder.html?invariant="+t,s=1;s<arguments.length;s++)a+="&args[]="+encodeURIComponent(arguments[s]);return e.message="Minified React error #"+t+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",e}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g={};function y(e,t,a){this.props=e,this.context=t,this.refs=g,this.updater=a||b}function E(){}function x(e,t,a){this.props=e,this.context=t,this.refs=g,this.updater=a||b}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw v(Error(85));this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},E.prototype=y.prototype;var w=x.prototype=new E;w.constructor=x,s(w,y.prototype),w.isPureReactComponent=!0;var C={current:null},T={suspense:null},S={current:null},M=Object.prototype.hasOwnProperty,A={key:!0,ref:!0,__self:!0,__source:!0};function z(e,t,a){var s=void 0,i={},r=null,o=null;if(null!=t)for(s in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(r=""+t.key),t)M.call(t,s)&&!A.hasOwnProperty(s)&&(i[s]=t[s]);var l=arguments.length-2;if(1===l)i.children=a;else if(1<l){for(var c=Array(l),m=0;m<l;m++)c[m]=arguments[m+2];i.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===i[s]&&(i[s]=l[s]);return{$$typeof:n,type:e,key:r,ref:o,props:i,_owner:S.current}}function k(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var P=/\/+/g,D=[];function j(e,t,a,s){if(D.length){var i=D.pop();return i.result=e,i.keyPrefix=t,i.func=a,i.context=s,i.count=0,i}return{result:e,keyPrefix:t,func:a,context:s,count:0}}function I(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>D.length&&D.push(e)}function O(e,t,a){return null==e?0:function e(t,a,s,i){var o=typeof t;"undefined"!==o&&"boolean"!==o||(t=null);var l=!1;if(null===t)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case n:case r:l=!0}}if(l)return s(i,t,""===a?"."+L(t,0):a),1;if(l=0,a=""===a?".":a+":",Array.isArray(t))for(var c=0;c<t.length;c++){var m=a+L(o=t[c],c);l+=e(o,m,s,i)}else if(null===t||"object"!=typeof t?m=null:m="function"==typeof(m=N&&t[N]||t["@@iterator"])?m:null,"function"==typeof m)for(t=m.call(t),c=0;!(o=t.next()).done;)l+=e(o=o.value,m=a+L(o,c++),s,i);else if("object"===o)throw s=""+t,v(Error(31),"[object Object]"===s?"object with keys {"+Object.keys(t).join(", ")+"}":s,"");return l}(e,"",t,a)}function L(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,function(e){return t[e]})}(e.key):t.toString(36)}function U(e,t){e.func.call(e.context,t,e.count++)}function R(e,t,a){var s=e.result,i=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?$(e,s,a,function(e){return e}):null!=e&&(k(e)&&(e=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,i+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(P,"$&/")+"/")+a)),s.push(e))}function $(e,t,a,s,i){var n="";null!=a&&(n=(""+a).replace(P,"$&/")+"/"),O(e,R,t=j(t,n,s,i)),I(t)}function F(){var e=C.current;if(null===e)throw v(Error(321));return e}var V={Children:{map:function(e,t,a){if(null==e)return e;var s=[];return $(e,s,null,t,a),s},forEach:function(e,t,a){if(null==e)return e;O(e,U,t=j(null,null,t,a)),I(t)},count:function(e){return O(e,function(){return null},null)},toArray:function(e){var t=[];return $(e,t,null,function(e){return e}),t},only:function(e){if(!k(e))throw v(Error(143));return e}},createRef:function(){return{current:null}},Component:y,PureComponent:x,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:u,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:m,_context:e},e.Consumer=e},forwardRef:function(e){return{$$typeof:h,render:e}},lazy:function(e){return{$$typeof:p,_ctor:e,_status:-1,_result:null}},memo:function(e,t){return{$$typeof:f,type:e,compare:void 0===t?null:t}},useCallback:function(e,t){return F().useCallback(e,t)},useContext:function(e,t){return F().useContext(e,t)},useEffect:function(e,t){return F().useEffect(e,t)},useImperativeHandle:function(e,t,a){return F().useImperativeHandle(e,t,a)},useDebugValue:function(){},useLayoutEffect:function(e,t){return F().useLayoutEffect(e,t)},useMemo:function(e,t){return F().useMemo(e,t)},useReducer:function(e,t,a){return F().useReducer(e,t,a)},useRef:function(e){return F().useRef(e)},useState:function(e){return F().useState(e)},Fragment:o,Profiler:c,StrictMode:l,Suspense:d,unstable_SuspenseList:_,createElement:z,cloneElement:function(e,t,a){if(null==e)throw v(Error(267),e);var i=void 0,r=s({},e.props),o=e.key,l=e.ref,c=e._owner;if(null!=t){void 0!==t.ref&&(l=t.ref,c=S.current),void 0!==t.key&&(o=""+t.key);var m=void 0;for(i in e.type&&e.type.defaultProps&&(m=e.type.defaultProps),t)M.call(t,i)&&!A.hasOwnProperty(i)&&(r[i]=void 0===t[i]&&void 0!==m?m[i]:t[i])}if(1===(i=arguments.length-2))r.children=a;else if(1<i){m=Array(i);for(var u=0;u<i;u++)m[u]=arguments[u+2];r.children=m}return{$$typeof:n,type:e.type,key:o,ref:l,props:r,_owner:c}},createFactory:function(e){var t=z.bind(null,e);return t.type=e,t},isValidElement:k,version:"16.9.0",unstable_withSuspenseConfig:function(e,t){var a=T.suspense;T.suspense=void 0===t?null:t;try{e()}finally{T.suspense=a}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:C,ReactCurrentBatchConfig:T,ReactCurrentOwner:S,IsSomeRendererActing:{current:!1},assign:s}},B={default:V},q=B&&V||B;e.exports=q.default||q},function(e,t,a){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var s=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;function r(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},a=0;a<10;a++)t["_"+String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(e){s[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},s)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var a,o,l=r(e),c=1;c<arguments.length;c++){for(var m in a=Object(arguments[c]))i.call(a,m)&&(l[m]=a[m]);if(s){o=s(a);for(var u=0;u<o.length;u++)n.call(a,o[u])&&(l[o[u]]=a[o[u]])}}return l}},function(e,t,a){"use strict";a.r(t);var s=a(0),i=a.n(s),n="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/components/QualityAndCertainty.js";const r="Selecciona la calidad de contenido del artÃ­culo",o=[["L","baja"],["M","media"],["H","alta"]],l="Selecciona el nivel de certeza del etiquetado",c=[["L","inseguro"],["M","medianamente seguro"],["H","seguro"]];var m=class extends i.a.Component{bootstrapRadio(e,t,a,s){return i.a.createElement("div",{className:"form-check",__source:{fileName:n,lineNumber:23},__self:this},i.a.createElement("label",{className:"form-check-label",htmlFor:"".concat(t,"Radio"),__source:{fileName:n,lineNumber:24},__self:this},i.a.createElement("input",{className:"form-check-input",type:"radio",id:"".concat(t,"Radio"),value:e,onChange:s,checked:a,__source:{fileName:n,lineNumber:25},__self:this}),t))}renderColumn(e,t,a){return i.a.createElement("div",{className:"container-fluid",__source:{fileName:n,lineNumber:41},__self:this},i.a.createElement("div",{className:"row",__source:{fileName:n,lineNumber:42},__self:this},i.a.createElement("p",{className:"mb-0",__source:{fileName:n,lineNumber:43},__self:this},e,":")),i.a.createElement("div",{className:"row",__source:{fileName:n,lineNumber:45},__self:this},i.a.createElement("div",{className:"col",__source:{fileName:n,lineNumber:46},__self:this},t)),i.a.createElement("div",{className:"row",__source:{fileName:n,lineNumber:50},__self:this},i.a.createElement("small",{className:"text-muted",__source:{fileName:n,lineNumber:51},__self:this},a)))}renderQualityOptions(){let e=o.map(([e,t],a)=>this.bootstrapRadio(e,t,this.props.quality===e,()=>this.props.changeQuality(e)));return this.renderColumn("Calidad",e,r)}renderCertaintyOptions(){let e=c.map(([e,t],a)=>this.bootstrapRadio(e,t,this.props.certainty===e,()=>this.props.changeCertainty(e)));return this.renderColumn("Certeza",e,l)}render(){return i.a.createElement("div",{className:"container-fluid",__source:{fileName:n,lineNumber:83},__self:this},i.a.createElement("div",{className:"row",__source:{fileName:n,lineNumber:84},__self:this},i.a.createElement("div",{className:"col",__source:{fileName:n,lineNumber:85},__self:this},this.renderQualityOptions()),i.a.createElement("div",{className:"col",__source:{fileName:n,lineNumber:88},__self:this},this.renderCertaintyOptions())))}},u="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/components/EventTypeBar.js";var h=class extends i.a.Component{renderButton(e){let t="btn selia-option-button mx-2 shadow";this.props.eventType===e.name?t+=" btn-primary":t+=" btn-light";let a="";return e.icon&&(a=i.a.createElement("img",{className:"mb-1",src:e.icon,alt:"Logo tipo de evento",style:{width:"100%"},__source:{fileName:u,lineNumber:17},__self:this})),i.a.createElement("div",{className:t,onClick:()=>this.props.changeEventType(e.name),__source:{fileName:u,lineNumber:22},__self:this},i.a.createElement("div",{className:"col",style:{width:"3em"},__source:{fileName:u,lineNumber:26},__self:this},i.a.createElement("div",{className:"row",__source:{fileName:u,lineNumber:27},__self:this},a),i.a.createElement("div",{className:"row",__source:{fileName:u,lineNumber:30},__self:this},i.a.createElement("small",{__source:{fileName:u,lineNumber:31},__self:this},e.name))))}renderEventButtons(){let e=this.props.info.itemType.event_types.map(e=>this.renderButton(e));return i.a.createElement("div",{__source:{fileName:u,lineNumber:45},__self:this},e)}render(){return i.a.createElement("div",{className:"container",__source:{fileName:u,lineNumber:53},__self:this},i.a.createElement("div",{className:"row",__source:{fileName:u,lineNumber:54},__self:this},i.a.createElement("div",{className:"col",__source:{fileName:u,lineNumber:55},__self:this},i.a.createElement("p",{__source:{fileName:u,lineNumber:56},__self:this},"Selecciona el tipo de evento a anotar:"))),i.a.createElement("div",{className:"row",__source:{fileName:u,lineNumber:59},__self:this},i.a.createElement("div",{className:"col",__source:{fileName:u,lineNumber:60},__self:this},this.renderEventButtons())))}},d="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/components/Comments.js";var _=class extends i.a.Component{render(){return i.a.createElement("div",{className:"form-group w-100 p-3",__source:{fileName:d,lineNumber:7},__self:this},i.a.createElement("label",{htmlFor:"inputCommentaries",__source:{fileName:d,lineNumber:8},__self:this},"Comentarios:"),i.a.createElement("textarea",{type:"text",value:this.props.commentaries,onChange:e=>this.props.changeComment(e.target.value),id:"inputCommentaries",className:"form-control w-100",__source:{fileName:d,lineNumber:11},__self:this}))}},f="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/components/AutocompleteTermInput.js";const p=200,N=20;var v=class extends i.a.Component{constructor(e){super(e),this.state={dropdown:!1,resolve:[],selected:"",value:"",loading:""},this.selected=null,this.resolving=null,this.loadingQueue=[],this.options={},this.handleClickOutside=this.handleClickOutside.bind(this)}componentDidUpdate(){this.props.blocked&&""!==this.state.selected&&this.setState({dropdown:!1,resolve:[],selected:"",value:""}),null!==this.props.selectedTerm&&null===this.selected&&(this.selected=this.props.selectedTerm)}render(){let e=this.props.info;return i.a.createElement("div",{className:"container-fluid p-0 my-2",ref:e=>{this.dropdownContainer=e},__source:{fileName:f,lineNumber:41},__self:this},i.a.createElement("div",{className:"row m-0",__source:{fileName:f,lineNumber:44},__self:this},i.a.createElement("div",{className:"input-group",__source:{fileName:f,lineNumber:45},__self:this},i.a.createElement("div",{className:"input-group-prepend",__source:{fileName:f,lineNumber:46},__self:this},i.a.createElement("span",{className:"input-group-text",__source:{fileName:f,lineNumber:47},__self:this},e.name)),this.renderFormContent())),this.renderDropdown())}renderFormContent(){return this.props.blocked?this.renderBlockedContent():""!==this.state.selected||""!==(this.props.selected.value||"")?this.renderSelected():this.state.resolve.length>0?this.renderResolvingContent():i.a.createElement("input",{type:"text",className:"form-control",value:this.state.value,onClick:()=>this.setState({dropdown:!0}),onChange:e=>this.handleChange(e.target.value),__source:{fileName:f,lineNumber:71},__self:this})}renderBlockedContent(){return i.a.createElement("div",{className:"form-control",style:{backgroundColor:"var(--lavander-dark)"},__source:{fileName:f,lineNumber:83},__self:this},this.props.selected.value,this.renderSearchButton(this.props.selected.value))}renderSearchButton(e){return i.a.createElement("span",{className:"float-right mx-2 btn btn-link p-0",onClick:()=>{this.searchContent(e)},__source:{fileName:f,lineNumber:92},__self:this},i.a.createElement("i",{className:"fas fa-search",__source:{fileName:f,lineNumber:93},__self:this}))}searchContent(e){window.open("https://www.google.com/search?q=".concat(e),"_blank")}renderSelected(){let e=this.props.selected.value||this.state.selected;return i.a.createElement("div",{className:"form-control",style:{backgroundColor:"var(--lavander)"},__source:{fileName:f,lineNumber:106},__self:this},e,this.renderSearchButton(e),i.a.createElement("span",{className:"float-right btn btn-link p-0",onClick:()=>this.resetForm(),__source:{fileName:f,lineNumber:109},__self:this},i.a.createElement("i",{className:"fas fa-times",__source:{fileName:f,lineNumber:113},__self:this})))}resetForm(){this.props.cleanForm(this.selected),this.selected=null,this.setState({dropdown:!1,selected:"",value:""})}renderResolvingDropdown(){return this.state.resolve.map(e=>i.a.createElement("div",{className:"dropdown-item",onClick:()=>this.resolveSynonym(e.target),__source:{fileName:f,lineNumber:129},__self:this},e.target.value))}resolveSynonym(e){let t="".concat(this.resolving.value," => ").concat(e.value);this.selected=e,this.props.updateLabel(e),this.resolving=null,this.setState({selected:t,dropdown:!1,resolve:[]})}renderResolvingContent(){return i.a.createElement("div",{className:"form-control bg-light text-danger",__source:{fileName:f,lineNumber:149},__self:this},"Multiples sinÃ³nimos encontrados. Favor de seleccionar uno")}getOptionsList(){return this.options[this.state.value].results}renderDropdownContents(){if(this.state.resolve.length>0)return this.renderResolvingDropdown();if(""===this.state.value)return this.renderInitialOption();if(!(this.state.value in this.options)&&this.state.loading===this.state.value)return this.renderLoadingOption();if(!(this.state.value in this.options))return this.renderWrittingOption();let e=this.getOptionsList();return 0===e.length?this.renderEmptyOption():this.renderOptionsList(e)}renderOptionsList(e){let t=new Set,a=new Set;e.forEach(e=>{t.has(e.value)?a.add(e.value):t.add(e.value)});let s=e.map(e=>{let t=a.has(e.value)?" (".concat(e.scope,")"):"";return i.a.createElement("div",{className:"dropdown-item",onClick:()=>this.selectOption(e),__source:{fileName:f,lineNumber:200},__self:this},e.value,t)});if(this.state.loading===this.state.value){let e=i.a.createElement("div",{className:"dropdown-item bg-light",onClick:()=>this.loadMoreOptions(),__source:{fileName:f,lineNumber:211},__self:this},i.a.createElement("span",{className:"btn btn-link text-muted",__source:{fileName:f,lineNumber:215},__self:this},"Cargando informaciÃ³n..."));s.push(e)}else if(this.options[this.state.value].next){let e=i.a.createElement("div",{className:"dropdown-item",onClick:()=>this.loadMoreOptions(),__source:{fileName:f,lineNumber:221},__self:this},i.a.createElement("span",{className:"btn btn-link",__source:{fileName:f,lineNumber:225},__self:this},"Cargar mÃ¡s opciones"));s.push(e)}return s}selectOption(e){let t=e.synonyms,a=e,s=a.value;if(t.length>0){if(t.length>1)return this.resolving=e,void this.setState({resolve:t});a=t[0].target,s="".concat(s," => ").concat(a.value)}this.props.updateLabel(a),this.selected=a,this.setState({selected:s,dropdown:!1})}renderDropdown(){return this.props.blocked?"":this.state.dropdown?i.a.createElement("div",{className:"row m-0",__source:{fileName:f,lineNumber:262},__self:this},i.a.createElement("div",{className:"autocomplete-dropdown w-100 border bg-white rounded",__source:{fileName:f,lineNumber:263},__self:this},this.renderDropdownContents())):""}renderInitialOption(){return i.a.createElement("div",{className:"dropdown-item bg-light text-muted",__source:{fileName:f,lineNumber:275},__self:this},"Escribe algo para empezar a buscar...")}renderEmptyOption(){return i.a.createElement("div",{className:"dropdown-item bg-light text-muted",__source:{fileName:f,lineNumber:283},__self:this},"Sin resultados.")}renderLoadingOption(){return i.a.createElement("div",{className:"dropdown-item bg-light text-muted",__source:{fileName:f,lineNumber:291},__self:this},"Cargando informaciÃ³n...")}renderWrittingOption(){return i.a.createElement("div",{className:"dropdown-item bg-light",__source:{fileName:f,lineNumber:299},__self:this},"Â ")}componentDidMount(){document.addEventListener("mousedown",this.handleClickOutside)}componentWillUnmount(){document.removeEventListener("mousedown",this.handleClickOutside)}handleClickOutside(e){this.dropdownContainer&&!this.dropdownContainer.contains(e.target)&&this.setState({dropdown:!1})}handleChange(e){this.setState({value:e},()=>{setTimeout(()=>{this.state.value===e&&""!==e&&this.queryTerms(e)},p)})}queryTerms(e){if(!(e in this.options)){if(this.loadingQueue.push(e),this.loadingQueue.length>N){let e=this.loadingQueue.shift(0);delete this.options[e]}this.setState({loading:e},()=>{let t=this.props.termType,a=this.props.urls.terms_autocomplete+encodeURI("?term_type=".concat(t,"&value__icontains=").concat(e));fetch(a).then(e=>e.json()).then(t=>{this.options[e]={count:t.count,next:t.next,results:t.results},e===this.state.value&&this.setState({loading:""})})})}}loadMoreOptions(){let e=this.options[this.state.value].next,t=this.state.value;this.setState({loading:t},()=>{fetch(e).then(e=>e.json()).then(e=>{this.options[t].next=e.next,this.options[t].results=this.options[t].results.concat(e.results),this.setState({loading:""})})})}},b="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/components/Labels.js";var g=class extends i.a.Component{constructor(e){super(e),this.initialLabels=this.props.initialLabels,this.state={blocked:{},selected:{}},this.terms={}}componentDidMount(){this.initLabels()}initLabels(){if(null===this.initialLabels)return;let e={},t={},a=new Set;this.initialLabels.forEach(s=>{e[s.id]=s,t[s.term_type]=s,s.entailments.forEach(e=>{a.add(e.id)})}),[...new Set(Object.keys(e))].filter(e=>!a.has(parseInt(e))).map(t=>e[t]).forEach(e=>this.updateLabel(e)),this.terms=t}render(){return i.a.createElement("div",{className:"col m-3",__source:{fileName:b,lineNumber:49},__self:this},i.a.createElement("div",{className:"row mb-2",__source:{fileName:b,lineNumber:50},__self:this},this.renderHeader()),i.a.createElement("div",{className:"row container-fluid border rounded inner-shadow-sm p-2",__source:{fileName:b,lineNumber:53},__self:this},this.renderLabelForms()))}renderHeader(){return i.a.createElement("p",{className:"mb-0",__source:{fileName:b,lineNumber:62},__self:this},"Posibles etiquetas para ",i.a.createElement("span",{className:"text-primary",__source:{fileName:b,lineNumber:63},__self:this},this.props.eventType),":")}getEventInfo(){let e=this.props.info.itemType.event_types;for(var t=0;t<e.length;t++){let a=e[t];if(a.name===this.props.eventType)return a}}renderLabelForms(){let e=this.getEventInfo().term_types.map(e=>{let t=this.state.selected[e.name]||"",a=null;return""!==t&&(a=this.terms[e.name]||null),i.a.createElement(v,{info:e,termType:e.name,updateLabel:e=>this.updateLabel(e),cleanForm:e=>this.cleanForm(e),urls:this.props.urls,blocked:""!==(this.state.blocked[e.name]||""),selected:t,selectedTerm:a,__source:{fileName:b,lineNumber:91},__self:this})});return i.a.createElement("div",{className:"col p-1",style:{position:"relative"},__source:{fileName:b,lineNumber:105},__self:this},i.a.createElement("div",{className:"container-fluid p-0",style:{overflowX:"hidden",overflowY:"hidden"},__source:{fileName:b,lineNumber:106},__self:this},e))}cleanForm(e){this.setState(t=>(delete t.selected[e.term_type],e.entailments.forEach(e=>{t.blocked[e.term_type]="",delete t.selected[e.term_type]}),t),()=>this.props.changeLabels(this.state.selected))}updateLabel(e){let t=this.getEventInfo(),a=new Set(t.term_types.map(e=>e.name));this.setState(t=>(t.selected[e.term_type]={id:e.id,value:e.value},e.entailments.forEach(s=>{a.has(s.term_type)&&(t.blocked[s.term_type]=e.term_type,t.selected[s.term_type]={id:s.id,value:s.value})}),t),()=>this.props.changeLabels(this.state.selected))}},y="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/components/FormControler.js";var E=class extends i.a.Component{constructor(e){super(e),this.initial=this.props.initial?this.props.initial:{},this.selectType=void 0===this.props.selectType||this.props.selectType,this.initialLabels=this.initial.labels||null,this.state=this.createInitialState()}createInitialState(){let e=null===this.initialLabels?null:this.initialLabels.map(e=>e.id);return{eventType:this.initial.event_type||null,commentaries:this.initial.commentaries||"",quality:this.initial.quality||null,certainty:this.initial.certainty||null,labels:e}}renderSubmitButton(){return this.props.ready?i.a.createElement("div",{className:"d-flex w-100 justify-content-center",__source:{fileName:y,lineNumber:36},__self:this},i.a.createElement("div",{className:"btn btn-link",onClick:()=>this.props.submit(),__source:{fileName:y,lineNumber:37},__self:this},"Crear")):i.a.createElement(i.a.Fragment,{__source:{fileName:y,lineNumber:45},__self:this},i.a.createElement("div",{className:"d-flex w-100 justify-content-center",__source:{fileName:y,lineNumber:46},__self:this},i.a.createElement("span",{className:"text-info",__source:{fileName:y,lineNumber:47},__self:this},"Llena toda la informaciÃ³n antes de poder crear una anotaciÃ³n.")),i.a.createElement("div",{className:"d-flex w-100 justify-content-center",__source:{fileName:y,lineNumber:51},__self:this},i.a.createElement("div",{className:"btn btn-link disabled",__source:{fileName:y,lineNumber:52},__self:this},"Crear")))}renderLabelFormContent(){return this.state.eventType?i.a.createElement(g,{ref:e=>{this.labelsNode=e},eventType:this.state.eventType,info:this.props.info,labels:this.state.labels,initialLabels:this.initialLabels,changeLabels:e=>this.changeLabels(e),urls:this.props.urls,__source:{fileName:y,lineNumber:61},__self:this}):i.a.createElement("div",{className:"container rounded bg-light inner-shadow-sm m-2",style:{height:"10em"},__source:{fileName:y,lineNumber:74},__self:this},i.a.createElement("div",{className:"w-100 h-100 d-flex flex-column justify-content-center",__source:{fileName:y,lineNumber:78},__self:this},i.a.createElement("h6",{className:"w-100 text-center text-info",__source:{fileName:y,lineNumber:79},__self:this},"Favor de seleccionar un tipo de evento a anotar")))}changeLabels(e){let t=[];for(let a in e)t.push(e[a].id);this.setState({labels:t}),this.props.setFormInfo({labels:t})}changeEventType(e){this.setState({eventType:e}),this.props.setFormInfo({eventType:e})}changeCertainty(e){this.setState({certainty:e}),this.props.setFormInfo({certainty:e})}changeQuality(e){this.setState({quality:e}),this.props.setFormInfo({quality:e})}changeComment(e){this.setState({commentaries:e}),this.props.setFormInfo({commentaries:e})}renderSelectTypeBar(){return this.selectType?i.a.createElement("div",{className:"row",__source:{fileName:y,lineNumber:119},__self:this},i.a.createElement(h,{eventType:this.state.eventType,info:this.props.info,changeEventType:e=>this.changeEventType(e),__source:{fileName:y,lineNumber:120},__self:this})):""}renderExtra(){}render(){return i.a.createElement(i.a.Fragment,{__source:{fileName:y,lineNumber:133},__self:this},this.renderExtra(),this.renderSelectTypeBar(),i.a.createElement("div",{className:"row",__source:{fileName:y,lineNumber:136},__self:this},this.renderLabelFormContent()),i.a.createElement("div",{className:"row",__source:{fileName:y,lineNumber:139},__self:this},i.a.createElement(m,{certainty:this.state.certainty,quality:this.state.quality,changeCertainty:e=>this.changeCertainty(e),changeQuality:e=>this.changeQuality(e),__source:{fileName:y,lineNumber:140},__self:this})),i.a.createElement("div",{className:"row",__source:{fileName:y,lineNumber:146},__self:this},i.a.createElement(_,{commentaries:this.state.commentaries,changeComment:e=>this.changeComment(e),__source:{fileName:y,lineNumber:147},__self:this})),i.a.createElement("div",{className:"row",__source:{fileName:y,lineNumber:151},__self:this},this.renderSubmitButton()))}},x="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/components/AnnotationToolBar.js";var w=class extends i.a.Component{render(){let e="";return(this.props.info.length||0)>0&&(e=this.props.info.map(e=>this.renderAnnotationTypeOption(e))),i.a.createElement("div",{className:"col rounded border p-1",__source:{fileName:x,lineNumber:12},__self:this},i.a.createElement("div",{className:"d-inline mx-1",__source:{fileName:x,lineNumber:13},__self:this},"Tipo de anotaciÃ³n:"),e)}renderAnnotationTypeOption(e){let t,a="border p-2 mx-1 shadow-sm btn ";return this.props.active&&this.props.selected===e.annotation_type?a+="btn-primary":a+="btn-light",t=e.icon?i.a.createElement("img",{src:e.icon,alt:"Logo tipo de anotaciÃ³n",style:{width:"100%"},__source:{fileName:x,lineNumber:33},__self:this}):i.a.createElement("small",{__source:{fileName:x,lineNumber:37},__self:this},e.annotation_type),i.a.createElement("div",{className:a,style:{width:"2.5em"},onClick:()=>this.selectAnnotationType(e.annotation_type),__source:{fileName:x,lineNumber:44},__self:this},t)}selectAnnotationType(e){this.props.selected===e&&this.props.active||this.props.select(e)}},C="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/create/VisualizerControler.js";var T=class extends i.a.Component{constructor(e){super(e),this.state={active:!1,selectedAnnotationType:null}}render(){return i.a.createElement("div",{className:"col",__source:{fileName:C,lineNumber:17},__self:this},i.a.createElement("div",{className:"row",__source:{fileName:C,lineNumber:18},__self:this},i.a.createElement(w,{info:this.props.info.annotationTypes,active:this.state.active,selected:this.state.selectedAnnotationType,select:e=>this.selectAnnotationType(e),__source:{fileName:C,lineNumber:19},__self:this})),this.renderVisualizerToolbar(),i.a.createElement("div",{className:"row",__source:{fileName:C,lineNumber:27},__self:this},this.renderCanvas()))}selectAnnotationType(e){this.visualizer&&this.visualizer.deactivate(),this.setState({selectedAnnotationType:e,active:!0},()=>{this.props.setAnnotationInfo({annotationType:e}),this.loadAnnotator()})}renderVisualizerToolbar(){if(this.visualizer)return i.a.createElement("div",{className:"row",__source:{fileName:C,lineNumber:51},__self:this},this.visualizer.renderToolbar())}loadVisualizer(){let e=this.props.info.item;this.visualizer=new this.props.components.visualizer({canvas:this.visualizerCanvas,itemInfo:e,active:!this.state.active,activator:()=>this.activateVisualizer()}),this.props.setAnnotationInfo({annotationTool:{name:this.visualizer.name,version:this.visualizer.version,description:this.visualizer.description,configuration_schema:this.visualizer.configuration_schema}}),this.forceUpdate()}activateVisualizer(){this.visualizer.activate(),this.setState({active:!1})}loadAnnotator(){let e=this.state.selectedAnnotationType;if(e&&e in this.props.components.annotators){this.annotator&&this.annotator.unmount();let t=this.props.components.annotators[e];this.annotator=new t({canvas:this.annotatorCanvas,visualizer:this.visualizer,edit:!0,registerAnnotation:e=>this.registerAnnotation(e)})}}registerAnnotation(e){this.props.setAnnotationInfo({annotation:e,annotationConfiguration:this.visualizer.getConfig()})}componentDidMount(){this.loadVisualizer()}componentWillUnmount(){this.visualizer&&(this.visualizer.unmount(),this.visualizer=null),this.annotator&&(this.annotator.unmount(),this.annotator=null)}renderCanvas(){return i.a.createElement("div",{className:"col",__source:{fileName:C,lineNumber:124},__self:this},i.a.createElement("div",{className:"row",style:{height:"30em",width:"100%",textAlign:"center"},__source:{fileName:C,lineNumber:125},__self:this},i.a.createElement("canvas",{ref:e=>{this.visualizerCanvas=e},style:{display:"block",position:"absolute"},__source:{fileName:C,lineNumber:126},__self:this}),i.a.createElement("canvas",{ref:e=>{this.annotatorCanvas=e},style:{display:"block",position:"absolute",pointerEvents:this.state.active?"auto":"none"},__source:{fileName:C,lineNumber:134},__self:this})))}},S="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/AnnotationCreator.js";var M=class extends i.a.Component{constructor(e){super(e);this.props.visualizer;this.annotationData={item:e.info.item},this.state={ready:!1}}render(){return i.a.createElement("div",{className:"container-fluid",__source:{fileName:S,lineNumber:23},__self:this},i.a.createElement("div",{className:"row p-2",__source:{fileName:S,lineNumber:24},__self:this},i.a.createElement("div",{className:"col-7 p-2",__source:{fileName:S,lineNumber:25},__self:this},i.a.createElement("div",{className:"container-fluid w-100 description_object",__source:{fileName:S,lineNumber:26},__self:this},i.a.createElement(T,{components:this.props.components,info:this.props.info,urls:this.props.urls,setAnnotationInfo:e=>this.setAnnotationData(e),__source:{fileName:S,lineNumber:27},__self:this}))),i.a.createElement("div",{className:"col-5 p-2",__source:{fileName:S,lineNumber:35},__self:this},i.a.createElement("div",{className:"container-fluid w-100 description_object",__source:{fileName:S,lineNumber:36},__self:this},i.a.createElement(E,{ready:this.state.ready,info:this.props.info,urls:this.props.urls,setFormInfo:e=>this.setAnnotationData(e),submit:()=>this.submit(),__source:{fileName:S,lineNumber:37},__self:this})))),this.renderModals())}renderModals(){let e=i.a.createElement("div",{className:"modal fade",id:"noPermissionModal",tabIndex:"-1",role:"dialog","aria-hidden":"true",__source:{fileName:S,lineNumber:54},__self:this},i.a.createElement("div",{className:"modal-dialog modal-dialog-centered",role:"document",__source:{fileName:S,lineNumber:55},__self:this},i.a.createElement("div",{className:"modal-content",__source:{fileName:S,lineNumber:56},__self:this},i.a.createElement("div",{className:"modal-body",__source:{fileName:S,lineNumber:57},__self:this},i.a.createElement("span",{className:"text-center text-danger w-100",__source:{fileName:S,lineNumber:58},__self:this},"Lo sentimos. No tienes permiso para realizar esta acciÃ³n."))))),t=i.a.createElement("div",{className:"modal fade",id:"sucessModal",tabIndex:"-1",role:"dialog","aria-labelledby":"exampleModalCenterTitle","aria-hidden":"true",__source:{fileName:S,lineNumber:65},__self:this},i.a.createElement("div",{className:"modal-dialog modal-dialog-centered",role:"document",__source:{fileName:S,lineNumber:66},__self:this},i.a.createElement("div",{className:"modal-content",__source:{fileName:S,lineNumber:67},__self:this},i.a.createElement("div",{className:"modal-body",__source:{fileName:S,lineNumber:68},__self:this},i.a.createElement("span",{className:"text-center text-success w-100",__source:{fileName:S,lineNumber:69},__self:this},"AnotaciÃ³n registrada")))));return i.a.createElement("div",{__source:{fileName:S,lineNumber:77},__self:this},t,e)}setAnnotationData(e){"annotationType"in e&&(this.annotationData.annotation_type=e.annotationType),"annotation"in e&&(this.annotationData.annotation=e.annotation),"labels"in e&&(this.annotationData.labels=e.labels),"commentaries"in e&&(this.annotationData.commentaries=e.commentaries),"quality"in e&&(this.annotationData.quality=e.quality),"certainty"in e&&(this.annotationData.certainty=e.certainty),"eventType"in e&&(this.annotationData.event_type=e.eventType),"annotationTool"in e&&(this.annotationData.annotation_tool=e.annotationTool),"annotationConfiguration"in e&&(this.annotationData.annotation_configuration=e.annotationConfiguration),this.checkIfReady()}checkIfReady(){let e=!0;"annotation_type"in this.annotationData||(e=!1),"annotation"in this.annotationData||(e=!1),"event_type"in this.annotationData||(e=!1),"labels"in this.annotationData&&0!==this.annotationData.labels.size||(e=!1),!this.state.ready&&e&&this.setState({ready:!0}),this.state.ready.submit&&!e&&this.setState({ready:!1})}submit(){$.ajax({type:"POST",url:this.props.urls.annotations,data:JSON.stringify(this.annotationData),contentType:"application/json",success:()=>this.createSuccess()}).catch(e=>{403===e.status&&this.showForbidden()})}createSuccess(){$("#sucessModal").modal("show"),setTimeout(()=>{$("#sucessModal").modal("hide"),setTimeout(()=>this.props.changePhase(),200)},800)}showForbidden(){$("#noPermissionModal").modal("show"),setTimeout(()=>{$("#noPermissionModal").modal("hide")},1200)}},A="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/list/VisualizerControler.js";var z=class extends i.a.Component{render(){return i.a.createElement("div",{className:"col",__source:{fileName:A,lineNumber:7},__self:this},this.renderVisualizerToolbar(),i.a.createElement("div",{className:"row",__source:{fileName:A,lineNumber:9},__self:this},this.renderCanvas()))}renderVisualizerToolbar(){if(this.visualizer)return i.a.createElement("div",{className:"row",__source:{fileName:A,lineNumber:19},__self:this},this.visualizer.renderToolbar())}loadVisualizer(){let e=this.props.info.item;this.visualizer=new this.props.components.visualizer({canvas:this.visualizerCanvas,itemInfo:e}),this.forceUpdate()}loadAnnotator(){this.props.annotator&&(this.annotator=new this.props.annotator({canvas:this.annotatorCanvas,visualizer:this.visualizer,annotation:this.props.annotation}))}componentDidMount(){this.loadVisualizer()}componentDidUpdate(){this.loadAnnotator()}componentWillUnmount(){this.visualizer&&(this.visualizer.unmount(),this.visualizer=null),this.annotator&&(this.annotator.unmount(),this.annotator=null)}renderCanvas(){return i.a.createElement("div",{className:"col",__source:{fileName:A,lineNumber:69},__self:this},i.a.createElement("div",{className:"row",style:{height:"30em",width:"100%",textAlign:"center"},__source:{fileName:A,lineNumber:70},__self:this},i.a.createElement("canvas",{ref:e=>{this.visualizerCanvas=e},style:{display:"block",position:"absolute"},__source:{fileName:A,lineNumber:71},__self:this}),i.a.createElement("canvas",{ref:e=>{this.annotatorCanvas=e},style:{display:"block",position:"absolute",pointerEvents:"none"},__source:{fileName:A,lineNumber:79},__self:this})))}},k="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/AnnotationList.js";var P=class extends i.a.Component{constructor(e){super(e),this.STARTING_PAGE=1,this.pageSize=6,this.state={page:this.STARTING_PAGE,annotationInfo:{},selectedAnnotationType:null,annotation:null}}render(){let e=this.props.components.annotators[this.state.selectedAnnotationType]||null;return i.a.createElement("div",{className:"container-fluid",__source:{fileName:k,lineNumber:24},__self:this},i.a.createElement("div",{className:"row p-2",__source:{fileName:k,lineNumber:25},__self:this},i.a.createElement("div",{className:"col-7 p-2",__source:{fileName:k,lineNumber:26},__self:this},i.a.createElement("div",{className:"container-fluid w-100 description_object",__source:{fileName:k,lineNumber:27},__self:this},i.a.createElement(z,{components:this.props.components,annotator:e,annotation:this.state.annotation,info:this.props.info,__source:{fileName:k,lineNumber:28},__self:this}))),i.a.createElement("div",{className:"col-5 p-2",__source:{fileName:k,lineNumber:36},__self:this},i.a.createElement("div",{className:"container-fluid w-100 description_object",__source:{fileName:k,lineNumber:37},__self:this},i.a.createElement("div",{className:"row",style:{overflowY:"auto",height:"35em"},__source:{fileName:k,lineNumber:38},__self:this},this.renderPage()),this.renderPaginator()))))}renderPaginator(){if(!(this.STARTING_PAGE in this.state.annotationInfo))return"";let e=this.state.annotationInfo[this.STARTING_PAGE],t=Math.ceil(e.count/this.pageSize);if(1===t)return"";let a=[];1===this.state.page?a.push(i.a.createElement("li",{className:"page-item disabled",__source:{fileName:k,lineNumber:64},__self:this},i.a.createElement("div",{className:"page-link",tabIndex:"-1","aria-disabled":"true",__source:{fileName:k,lineNumber:65},__self:this},i.a.createElement("i",{className:"fas fa-angle-left",__source:{fileName:k,lineNumber:66},__self:this})))):a.push(i.a.createElement("li",{className:"page-item",__source:{fileName:k,lineNumber:72},__self:this},i.a.createElement("div",{className:"page-link",onClick:()=>this.changePage(this.state.page-1),__source:{fileName:k,lineNumber:73},__self:this},i.a.createElement("i",{className:"fas fa-angle-left",__source:{fileName:k,lineNumber:77},__self:this}))));for(let e=1;e<=t;e++)this.state.page===e?a.push(i.a.createElement("li",{className:"page-item active","aria-current":"page",__source:{fileName:k,lineNumber:86},__self:this},i.a.createElement("div",{className:"page-link",__source:{fileName:k,lineNumber:87},__self:this},e," ",i.a.createElement("span",{className:"sr-only",__source:{fileName:k,lineNumber:88},__self:this},"(current)")))):a.push(i.a.createElement("li",{className:"page-item",__source:{fileName:k,lineNumber:94},__self:this},i.a.createElement("div",{className:"page-link",onClick:()=>this.changePage(e),__source:{fileName:k,lineNumber:95},__self:this},e)));return this.state.page===t?a.push(i.a.createElement("li",{className:"page-item disabled",__source:{fileName:k,lineNumber:105},__self:this},i.a.createElement("div",{className:"page-link",tabIndex:"-1","aria-disabled":"true",__source:{fileName:k,lineNumber:106},__self:this},i.a.createElement("i",{className:"fas fa-angle-right",__source:{fileName:k,lineNumber:107},__self:this})))):a.push(i.a.createElement("li",{className:"page-item",__source:{fileName:k,lineNumber:113},__self:this},i.a.createElement("div",{className:"page-link",onClick:()=>this.changePage(this.state.page+1),__source:{fileName:k,lineNumber:114},__self:this},i.a.createElement("i",{className:"fas fa-angle-right",__source:{fileName:k,lineNumber:118},__self:this})))),i.a.createElement("nav",{className:"w-100 p-2","aria-label":"Page navigation example",__source:{fileName:k,lineNumber:125},__self:this},i.a.createElement("ul",{className:"pagination justify-content-center",__source:{fileName:k,lineNumber:126},__self:this},a))}renderPage(){if(!(this.state.page in this.state.annotationInfo))return this.renderLoadingPage();let e=this.state.annotationInfo[this.state.page].results;if(0===e.length)return this.renderEmptyList();let t=e.map(e=>this.renderAnnotationItem(e));return i.a.createElement("div",{className:"container-fluid bg-light p-0 list-group my-4",__source:{fileName:k,lineNumber:149},__self:this},t)}changePage(e){e in this.state.annotationInfo||this.loadAnnotations(e),this.setState({page:e})}getAnnotationTypeInfo(e){let t=this.props.info.annotationTypes;for(var a=0;a<t.length;a++){let s=t[a];if(s.annotation_type===e)return s}}getEventTypeInfo(e){let t=this.props.info.itemType.event_types;for(var a=0;a<t.length;a++){let s=t[a];if(s.name===e)return s}}renderAnnotationItem(e){let t,a,s=this.getAnnotationTypeInfo(e.annotation_type),n=this.getEventTypeInfo(e.event_type),r=new Date(e.created_on);t=s.icon?i.a.createElement("img",{src:s.icon,alt:"Logo tipo de anotaciÃ³n",style:{width:"3em"},__source:{fileName:k,lineNumber:193},__self:this}):i.a.createElement("p",{__source:{fileName:k,lineNumber:197},__self:this},e.annotation_type),a=n.icon?i.a.createElement("img",{src:n.icon,alt:"Logo tipo de evento",style:{width:"3em"},__source:{fileName:k,lineNumber:204},__self:this}):i.a.createElement("p",{__source:{fileName:k,lineNumber:208},__self:this},e.event_type);let o=this.props.selectedAnnotation===e.id?"m-1 lavander-dark list_item":"m-1 list_item";return i.a.createElement("div",{className:o,onClick:()=>this.selectAnnotation(e),__source:{fileName:k,lineNumber:216},__self:this},i.a.createElement("div",{className:"row px-3",__source:{fileName:k,lineNumber:220},__self:this},i.a.createElement("div",{className:"col-2",__source:{fileName:k,lineNumber:221},__self:this},t),i.a.createElement("div",{className:"col-2",__source:{fileName:k,lineNumber:224},__self:this},a),i.a.createElement("div",{className:"col-8",__source:{fileName:k,lineNumber:227},__self:this},this.renderLabels(e.labels))),i.a.createElement("div",{className:"row d-flex justify-content-end",__source:{fileName:k,lineNumber:231},__self:this},i.a.createElement("small",{className:"text-muted mx-2",__source:{fileName:k,lineNumber:232},__self:this},"Creado el ",r.toLocaleString()),i.a.createElement("small",{className:"text-muted mx-2",__source:{fileName:k,lineNumber:235},__self:this},"Creado por ",e.created_by.username),i.a.createElement("small",{className:"btn-link text-primary mx-2",onClick:()=>this.editAnnotation(e),__source:{fileName:k,lineNumber:238},__self:this},"Editar ",i.a.createElement("i",{className:"fas fa-edit",__source:{fileName:k,lineNumber:242},__self:this}))))}editAnnotation(e){this.setState({annotation:e.annotation,selectedAnnotationType:e.annotation_type}),this.props.editAnnotation(e.id)}selectAnnotation(e){this.setState({annotation:e.annotation,selectedAnnotationType:e.annotation_type}),this.props.selectAnnotation(e.id)}renderLabels(e){return e.map(e=>i.a.createElement("span",{className:"badge badge-dark m-1",__source:{fileName:k,lineNumber:268},__self:this},e.value))}renderEmptyList(){return i.a.createElement("div",{className:"d-flex flex-column justify-content-center",style:{height:"20em"},__source:{fileName:k,lineNumber:275},__self:this},i.a.createElement("div",{className:"jumbotron",__source:{fileName:k,lineNumber:276},__self:this},i.a.createElement("h5",{className:"text-center w-100",__source:{fileName:k,lineNumber:277},__self:this},"Este artÃ­culo no tiene anotaciÃ³nes"),i.a.createElement("p",{className:"btn btn-link text-center w-100",onClick:()=>this.props.goToCreate(),__source:{fileName:k,lineNumber:278},__self:this},"Crear nueva anotaciÃ³n")))}renderLoadingPage(){return i.a.createElement("div",{className:"d-flex flex-column justify-content-center w-100 h-100",__source:{fileName:k,lineNumber:288},__self:this},i.a.createElement("div",{className:"d-flex justify-content-center",__source:{fileName:k,lineNumber:289},__self:this},i.a.createElement("div",{className:"spinner-border",role:"status",style:{width:"5rem",height:"5rem"},__source:{fileName:k,lineNumber:290},__self:this},i.a.createElement("span",{className:"sr-only",__source:{fileName:k,lineNumber:291},__self:this},"Loading..."))),i.a.createElement("div",{className:"w-100 text-center text-muted my-4",__source:{fileName:k,lineNumber:294},__self:this},"Cargando anotaciones..."))}componentDidMount(){this.loadAnnotations(this.STARTING_PAGE)}loadAnnotations(e){let t=this.props.urls.annotations+"?page=".concat(e,"&page_size=").concat(this.pageSize);fetch(t).then(e=>e.json()).then(t=>{this.setState(a=>(a.annotationInfo[e]=t,a))})}},D="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/detail/FormControlerUpdate.js";var j=class extends E{renderExtra(){return i.a.createElement("div",{className:"row d-flex justify-content-end px-2",__source:{fileName:D,lineNumber:8},__self:this},i.a.createElement("div",{className:"btn btn-light text-primary",onClick:()=>this.restore(),__source:{fileName:D,lineNumber:9},__self:this},"Restaurar ",i.a.createElement("i",{className:"fas fa-undo",__source:{fileName:D,lineNumber:10},__self:this})))}restore(){this.setState(this.createInitialState(),()=>{this.labelsNode&&this.labelsNode.initLabels()})}renderSubmitButton(){var e,t;this.props.ready?e=i.a.createElement("div",{className:"btn btn-link",onClick:()=>this.props.submit(),__source:{fileName:D,lineNumber:29},__self:this},"Actualizar"):(e=i.a.createElement("div",{className:"btn btn-link disabled",__source:{fileName:D,lineNumber:35},__self:this},"Actualizar"),t=i.a.createElement("div",{className:"d-flex w-100 justify-content-center",__source:{fileName:D,lineNumber:38},__self:this},i.a.createElement("span",{className:"text-info",__source:{fileName:D,lineNumber:39},__self:this},"Llena toda la informaciÃ³n antes de poder actualizar la anotaciÃ³n.")));let a=i.a.createElement("div",{className:"btn btn-link text-danger",onClick:()=>this.props.delete(),__source:{fileName:D,lineNumber:47},__self:this},"Eliminar");return i.a.createElement(i.a.Fragment,{__source:{fileName:D,lineNumber:51},__self:this},t,i.a.createElement("div",{className:"d-flex w-100 justify-content-center",__source:{fileName:D,lineNumber:53},__self:this},e," ",a))}},I="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/detail/VisualizerControler.js";var O=class extends i.a.Component{constructor(e){super(e),this.state={active:!1}}render(){return i.a.createElement("div",{className:"col",__source:{fileName:I,lineNumber:15},__self:this},i.a.createElement("div",{className:"row",__source:{fileName:I,lineNumber:16},__self:this},this.renderEditButtons()),this.renderVisualizerToolbar(),i.a.createElement("div",{className:"row",__source:{fileName:I,lineNumber:20},__self:this},this.renderCanvas()))}renderEditButtons(){let e=this.state.active?"btn btn-primary m-1":"btn btn-light m-1";return i.a.createElement("div",{className:"col p-2",__source:{fileName:I,lineNumber:30},__self:this},i.a.createElement("div",{className:e,onClick:()=>this.activateAnnotator(),__source:{fileName:I,lineNumber:31},__self:this},"Editar ",i.a.createElement("i",{className:"fas fa-edit",__source:{fileName:I,lineNumber:34},__self:this})),i.a.createElement("div",{className:"btn btn-light m-1",onClick:()=>this.restoreAnnotation(),__source:{fileName:I,lineNumber:36},__self:this},"Restaurar ",i.a.createElement("i",{className:"fas fa-undo",__source:{fileName:I,lineNumber:40},__self:this})),i.a.createElement("div",{className:"btn btn-light m-1",onClick:()=>this.focus(),__source:{fileName:I,lineNumber:42},__self:this},"Enfocar ",i.a.createElement("i",{className:"far fa-eye",__source:{fileName:I,lineNumber:46},__self:this})))}focus(){this.visualizer&&this.visualizer.setConfig(this.props.initial.annotation_configuration)}renderVisualizerToolbar(){if(this.visualizer)return i.a.createElement("div",{className:"row",__source:{fileName:I,lineNumber:61},__self:this},this.visualizer.renderToolbar())}loadVisualizer(){let e=this.props.info.item;this.visualizer=new this.props.components.visualizer({canvas:this.visualizerCanvas,itemInfo:e,active:!this.state.active,activator:()=>this.activateVisualizer()}),this.props.setAnnotationInfo({annotationTool:{name:this.visualizer.name,version:this.visualizer.version,description:this.visualizer.description,configuration_schema:this.visualizer.configuration_schema}}),this.loadAnnotator()}activateVisualizer(){this.visualizer.activate(),this.setState({active:!1})}activateAnnotator(){this.visualizer.deactivate(),this.setState({active:!0})}loadAnnotator(){let e=this.props.initial.annotation_type,t=this.props.components.annotators[e];this.annotator=new t({canvas:this.annotatorCanvas,visualizer:this.visualizer,annotation:this.props.initial.annotation,edit:!0,registerAnnotation:e=>this.registerAnnotation(e)})}restoreAnnotation(){this.annotator&&(this.annotator.annotation=this.props.initial.annotation,this.annotator.draw(),this.activateVisualizer(),this.setAnnotationInfo({annotation:this.props.initial.annotation,annotationConfiguration:this.props.initial.annotation_configuration}))}registerAnnotation(e){this.props.setAnnotationInfo({annotation:e,annotationConfiguration:this.visualizer.getConfig()})}componentDidMount(){this.loadVisualizer()}componentWillUnmount(){this.visualizer&&(this.visualizer.unmount(),this.visualizer=null),this.annotator&&(this.annotator.unmount(),this.annotator=null)}renderCanvas(){return i.a.createElement("div",{className:"col",__source:{fileName:I,lineNumber:150},__self:this},i.a.createElement("div",{className:"row",style:{height:"30em",width:"100%",textAlign:"center"},__source:{fileName:I,lineNumber:151},__self:this},i.a.createElement("canvas",{ref:e=>{this.visualizerCanvas=e},style:{display:"block",position:"absolute"},__source:{fileName:I,lineNumber:152},__self:this}),i.a.createElement("canvas",{ref:e=>{this.annotatorCanvas=e},style:{display:"block",position:"absolute",pointerEvents:this.state.active?"auto":"none"},__source:{fileName:I,lineNumber:160},__self:this})))}},L="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/AnnotationDetail.js";var U=class extends i.a.Component{constructor(e){super(e),this.annotationData={},this.state={ready:!1,loaded:!1}}render(){return i.a.createElement("div",{className:"container-fluid",__source:{fileName:L,lineNumber:20},__self:this},i.a.createElement("div",{className:"row p-2",__source:{fileName:L,lineNumber:21},__self:this},i.a.createElement("div",{className:"col-7 p-2",__source:{fileName:L,lineNumber:22},__self:this},i.a.createElement("div",{className:"container-fluid w-100 description_object",__source:{fileName:L,lineNumber:23},__self:this},this.renderVisualizer())),i.a.createElement("div",{className:"col-5 p-2",__source:{fileName:L,lineNumber:27},__self:this},i.a.createElement("div",{className:"container-fluid w-100 description_object",__source:{fileName:L,lineNumber:28},__self:this},this.renderForms()))),this.renderModals())}renderModals(){let e=i.a.createElement("div",{className:"modal fade",id:"updateModal",tabIndex:"-1",role:"dialog","aria-hidden":"true",__source:{fileName:L,lineNumber:40},__self:this},i.a.createElement("div",{className:"modal-dialog modal-dialog-centered",role:"document",__source:{fileName:L,lineNumber:41},__self:this},i.a.createElement("div",{className:"modal-content",__source:{fileName:L,lineNumber:42},__self:this},i.a.createElement("div",{className:"modal-body",__source:{fileName:L,lineNumber:43},__self:this},i.a.createElement("span",{className:"text-center text-success w-100",__source:{fileName:L,lineNumber:44},__self:this},"AnotaciÃ³n editada correctamente"))))),t=i.a.createElement("div",{className:"modal fade",id:"deleteModal",tabIndex:"-1",role:"dialog","aria-hidden":"true",__source:{fileName:L,lineNumber:52},__self:this},i.a.createElement("div",{className:"modal-dialog modal-dialog-centered",role:"document",__source:{fileName:L,lineNumber:53},__self:this},i.a.createElement("div",{className:"modal-content",__source:{fileName:L,lineNumber:54},__self:this},i.a.createElement("div",{className:"modal-body",__source:{fileName:L,lineNumber:55},__self:this},i.a.createElement("span",{className:"text-center text-success w-100",__source:{fileName:L,lineNumber:56},__self:this},"AnotaciÃ³n eliminada correctamente"))))),a=i.a.createElement("div",{className:"modal fade",id:"noPermissionModal",tabIndex:"-1",role:"dialog","aria-hidden":"true",__source:{fileName:L,lineNumber:64},__self:this},i.a.createElement("div",{className:"modal-dialog modal-dialog-centered",role:"document",__source:{fileName:L,lineNumber:65},__self:this},i.a.createElement("div",{className:"modal-content",__source:{fileName:L,lineNumber:66},__self:this},i.a.createElement("div",{className:"modal-body",__source:{fileName:L,lineNumber:67},__self:this},i.a.createElement("span",{className:"text-center text-danger w-100",__source:{fileName:L,lineNumber:68},__self:this},"Lo sentimos. No tienes permiso para realizar esta acciÃ³n.")))));return i.a.createElement("div",{__source:{fileName:L,lineNumber:76},__self:this},e,t,a)}renderVisualizer(){return this.state.loaded?i.a.createElement(O,{components:this.props.components,initial:this.initialData,info:this.props.info,urls:this.props.urls,setAnnotationInfo:e=>this.setAnnotationData(e),__source:{fileName:L,lineNumber:90},__self:this}):this.renderLoading()}renderForms(){return this.state.loaded?i.a.createElement(j,{ready:this.state.ready,info:this.props.info,urls:this.props.urls,initial:this.initialData,selectType:!1,setFormInfo:e=>this.setAnnotationData(e),submit:()=>this.submit(),delete:()=>this.delete(),__source:{fileName:L,lineNumber:106},__self:this}):this.renderLoading()}renderLoading(){return i.a.createElement("div",{className:"d-flex flex-column justify-content-center w-100 h-100",__source:{fileName:L,lineNumber:121},__self:this},i.a.createElement("div",{className:"d-flex justify-content-center",__source:{fileName:L,lineNumber:122},__self:this},i.a.createElement("div",{className:"spinner-border",role:"status",style:{width:"5rem",height:"5rem"},__source:{fileName:L,lineNumber:123},__self:this},i.a.createElement("span",{className:"sr-only",__source:{fileName:L,lineNumber:124},__self:this},"Loading..."))),i.a.createElement("div",{className:"w-100 text-center text-muted my-4",__source:{fileName:L,lineNumber:127},__self:this},"Cargando..."))}renderSuccessDialog(){return i.a.createElement("div",{className:"modal fade",id:"sucessModal",tabIndex:"-1",role:"dialog","aria-labelledby":"exampleModalCenterTitle","aria-hidden":"true",__source:{fileName:L,lineNumber:136},__self:this},i.a.createElement("div",{className:"modal-dialog modal-dialog-centered",role:"document",__source:{fileName:L,lineNumber:137},__self:this},i.a.createElement("div",{className:"modal-content",__source:{fileName:L,lineNumber:138},__self:this},i.a.createElement("div",{className:"modal-body",__source:{fileName:L,lineNumber:139},__self:this},i.a.createElement("span",{className:"text-center text-success w-100",__source:{fileName:L,lineNumber:140},__self:this},"AnotaciÃ³n registrada")))))}setAnnotationData(e){"annotation"in e&&(this.annotationData.annotation=e.annotation),"labels"in e&&(this.annotationData.labels=e.labels),"commentaries"in e&&(this.annotationData.commentaries=e.commentaries),"quality"in e&&(this.annotationData.quality=e.quality),"certainty"in e&&(this.annotationData.certainty=e.certainty),"annotationConfiguration"in e&&(this.annotationData.annotation_configuration=e.annotationConfiguration),"annotation_configuration"in e&&(this.annotationData.annotation_configuration=e.annotation_configuration),this.checkIfReady()}checkIfReady(){let e=!0;"annotation"in this.annotationData||(e=!1),"labels"in this.annotationData&&0!==this.annotationData.labels.length||(e=!1),!this.state.ready&&e&&this.setState({ready:!0}),this.state.ready&&!e&&this.setState({ready:!1})}getAnnotationInfo(){let e=this.props.urls.annotation_detail.replace("annotation_pk",this.props.selectedAnnotation);fetch(e).then(e=>e.json()).then(e=>{this.setAnnotationData(e),this.initialData=Object.assign({},e),this.setState({loaded:!0})})}componentDidMount(){this.getAnnotationInfo()}submit(){let e=this.props.urls.annotation_detail.replace("annotation_pk",this.props.selectedAnnotation);$.ajax({type:"PUT",url:e,data:JSON.stringify(this.annotationData),contentType:"application/json",success:()=>this.changeSuccess()}).catch(e=>{403===e.status&&this.showForbidden()})}delete(){let e=this.props.urls.annotation_detail.replace("annotation_pk",this.props.selectedAnnotation);$.ajax({type:"DELETE",url:e,contentType:"application/json",success:()=>this.deleteSuccess()}).catch(e=>{403===e.status&&this.showForbidden()})}deleteSuccess(){$("#deleteModal").modal("show"),setTimeout(()=>{$("#deleteModal").modal("hide"),setTimeout(()=>this.props.changePhase(),200)},800)}changeSuccess(){$("#updateModal").modal("show"),setTimeout(()=>{$("#updateModal").modal("hide"),setTimeout(()=>this.props.changePhase(),200)},800)}showForbidden(){$("#noPermissionModal").modal("show"),setTimeout(()=>{$("#noPermissionModal").modal("hide")},1200)}};var R=class{constructor(e){this.canvas=e.canvas,this.itemInfo=e.itemInfo,this.active=e.active||!0,this.activator=e.activator||(()=>null),this.events=this.getEvents(),this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.adjustSize(),this.init(),this.bindEvents()}createPoint(e,t){let a=this.svg.createSVGPoint();return a.x=e,a.y=t,a}adjustSize(){this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight}activate(){this.active=!0}deactivate(){this.active=!1}toggleActivate(){this.active=!this.active}emitUpdateEvent(){let e=new CustomEvent("visualizer-update");document.querySelectorAll("canvas").forEach(t=>t.dispatchEvent(e))}getEvents(){}init(){}draw(){}getConfig(){}setConfig(){}renderToolbar(){}canvasToPoint(e){return this.createPoint(e.x,e.y)}pointToCanvas(e){return this.createPoint(e.x,e.y)}validatePoints(e){return this.createPoint(e.x,e.y)}getMouseEventPosition(e){let t=e.offsetX||e.pageX-this.canvas.offsetLeft,a=e.offsetY||e.pageY-this.canvas.offsetTop;return this.createPoint(t,a)}bindEvents(){for(let e in this.events){let t=this.events[e];Array.isArray(t)||(t=[t]),t.forEach(t=>{this.canvas.addEventListener(e,t,!1)})}}unmount(){for(let e in this.events){let t=this.events[e];Array.isArray(t)||(t=[t]),t.forEach(t=>{this.canvas.removeEventListener(e,t)})}}},F="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/visualizer/ImageVisualizerToolbar.js";var V=class extends i.a.Component{render(){return i.a.createElement("div",{className:"col p-2",__source:{fileName:F,lineNumber:7},__self:this},this.renderMoveButton(),this.renderHomeButton())}renderMoveButton(){let e=this.props.active?"btn btn-primary m-1":"btn btn-light m-1";return i.a.createElement("button",{type:"button",className:e,onClick:()=>this.handleMove(),__source:{fileName:F,lineNumber:18},__self:this},i.a.createElement("i",{className:"fas fa-arrows-alt",__source:{fileName:F,lineNumber:23},__self:this}))}renderHomeButton(){return i.a.createElement("button",{type:"button",className:"btn btn-light m-1",onClick:()=>this.handleHome(),__source:{fileName:F,lineNumber:30},__self:this},i.a.createElement("i",{className:"fas fa-home",__source:{fileName:F,lineNumber:35},__self:this}))}handleMove(){this.props.activator(),this.forceUpdate()}handleHome(){this.props.home()}};const B="Visualizador de imagenes SELIA",q="1.0",G="Visualizador web que usa el contexto 2d de un canvas HTML5 para presentar imagenes png/jpg",H={definitions:{},$schema:"http://json-schema.org/draft-07/schema#",$id:"http://example.com/root.json",type:"object",title:"The Root Schema",required:["transformMatrix"],properties:{transformMatrix:{$id:"#/properties/transformMatrix",type:"object",title:"The Transformmatrix Schema",required:["a","b","c","d","e","f"],properties:{a:{$id:"#/properties/transformMatrix/properties/a",type:"number",title:"The A Schema",default:0,examples:[1]},b:{$id:"#/properties/transformMatrix/properties/b",type:"number",title:"The B Schema",default:0,examples:[0]},c:{$id:"#/properties/transformMatrix/properties/c",type:"number",title:"The C Schema",default:0,examples:[0]},d:{$id:"#/properties/transformMatrix/properties/d",type:"number",title:"The D Schema",default:0,examples:[1]},e:{$id:"#/properties/transformMatrix/properties/e",type:"number",title:"The E Schema",default:0,examples:[0]},f:{$id:"#/properties/transformMatrix/properties/f",type:"number",title:"The F Schema",default:0,examples:[0]}}}}};var Q="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/visualizer/imageVisualizer.js";var W=class extends R{constructor(...e){super(...e),this.name=B,this.version=q,this.description=G,this.configuration_schema=H}centerImage(){this.setTransform(1,0,0,1,0,0),this.factor=1;let e=(this.canvas.width-this.image.width)/2,t=(this.canvas.height-this.image.height)/2,a=this.createPoint(e,t);this.translate(a),this.emitUpdateEvent(),this.draw()}renderToolbar(){return i.a.createElement(V,{active:this.active,activator:this.activator,home:()=>this.centerImage(),__source:{fileName:Q,lineNumber:28},__self:this})}getItemUrl(){return this.itemInfo.url+"download/"}getEvents(){return this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseScroll=this.onMouseScroll.bind(this),{mousedown:this.onMouseDown,mousemove:this.onMouseMove,mouseup:this.onMouseUp,DOMMouseScroll:this.onMouseScroll,mousewheel:this.onMouseScroll}}onMouseDown(e){document.body.style.mozUserSelect=document.body.style.webkitUserSelect=document.body.style.userSelect="none",this.last=this.getMouseEventPosition(e),this.dragStart=this.canvasToPoint(this.last),this.dragged=!1}onMouseMove(e){if(this.last=this.getMouseEventPosition(e),this.dragged=!0,this.dragStart){var t=this.canvasToPoint(this.last);t.x-=this.dragStart.x,t.y-=this.dragStart.y,this.translate(t),this.emitUpdateEvent(),this.draw()}}onMouseUp(e){this.dragStart=null,this.dragged||this.zoom(e.shiftKey?-1:1)}onMouseScroll(e){var t=e.wheelDelta?e.wheelDelta/40:e.detail?-e.detail:0;return t&&this.zoom(t),e.preventDefault()&&!1}zoom(e){var t=Math.pow(1.1,e);if(!(this.factor*t<.5||this.factor*t>5)){this.factor=this.factor*t;var a=this.canvasToPoint(this.last);this.translate(a),this.scale(t,t),this.translate({x:-a.x,y:-a.y}),this.emitUpdateEvent(),this.draw()}}scale(e,t){this.transformMatrix=this.transformMatrix.scaleNonUniform(e,t),this.ctx.scale(e,t)}translate(e){this.transformMatrix=this.transformMatrix.translate(e.x,e.y),this.ctx.translate(e.x,e.y)}rotate(e){this.transformMatrix=this.transformMatrix.rotate(180*e/Math.PI),this.ctx.rotate(e)}transform(e,t,a,s,i,n){var r=this.svg.createSVGMatrix();return r.a=e,r.b=t,r.c=a,r.d=s,r.e=i,r.f=n,this.transformMatrix=this.transformMatrix.multiply(r),this.ctx.transform(e,t,a,s,i,n)}setTransform(e,t,a,s,i,n){this.transformMatrix.a=e,this.transformMatrix.b=t,this.transformMatrix.c=a,this.transformMatrix.d=s,this.transformMatrix.e=i,this.transformMatrix.f=n,this.ctx.setTransform(e,t,a,s,i,n)}canvasToPoint(e){return this.createPoint(e.x,e.y).matrixTransform(this.transformMatrix.inverse())}pointToCanvas(e){return this.createPoint(e.x,e.y).matrixTransform(this.transformMatrix)}draw(){this.save(),this.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.restore(),this.ctx.drawImage(this.image,0,0)}save(){this.transformHistory.push(this.transformMatrix.translate(0,0)),this.ctx.save()}restore(){this.transformMatrix=this.transformHistory.pop(),this.ctx.restore()}validatePoints(e){let t=Math.min(Math.max(e.x,0),this.image.width),a=Math.min(Math.max(e.y,0),this.image.height);return this.createPoint(t,a)}getConfig(){return{transformMatrix:{a:this.transformMatrix.a,b:this.transformMatrix.b,c:this.transformMatrix.c,d:this.transformMatrix.d,e:this.transformMatrix.e,f:this.transformMatrix.f}}}setConfig(e){let t=e.transformMatrix;this.setTransform(t.a,t.b,t.c,t.d,t.e,t.f),this.factor=Math.sqrt(t.a*t.d-t.b*t.c),this.draw(),this.emitUpdateEvent()}init(){this.canvas.style.cssText="-moz-box-shadow: inset 0 0 7px #404040;-webkit-box-shadow: inset 0 0 7px #404040;box-shadow:         inset 0 0 7px #404040;background-color: gray",this.ctx=this.canvas.getContext("2d"),this.image=new Image,this.image.src=this.getItemUrl(),this.transformMatrix=this.svg.createSVGMatrix(),this.transformHistory=[],this.last=this.createPoint(this.canvas.width/2,this.canvas.height/2),this.factor=1,this.dragStart=null,this.dragged=!1,this.image.onload=()=>{this.centerImage()}}};var Y=class{constructor(e){this.EMPTY_ANNOTATOR="empty",this.EDITING="edit",this.DONE="done",this.canvas=e.canvas,this.visualizer=e.visualizer,this.annotation=e.annotation||null,this.registerAnnotation=e.registerAnnotation||(()=>null),this.edit=e.edit||!1,this.phase=null!==this.annotation?this.DONE:this.EMPTY_ANNOTATOR,this.ctx=this.canvas.getContext("2d"),this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.events=this.getEvents(),this.canvas.addEventListener("visualizer-update",e=>this.draw(),!1),this.adjustSize(),this.init(),this.edit&&this.bindEvents(),this.draw()}createPoint(e,t){let a=this.svg.createSVGPoint();return a.x=e,a.y=t,a}getEvents(){return{}}adjustSize(){this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight}getMouseEventPosition(e){let t=e.offsetX||e.pageX-this.canvas.offsetLeft,a=e.offsetY||e.pageY-this.canvas.offsetTop;return this.createPoint(t,a)}init(){}drawAnnotation(e){}draw(){this.clean(),this.phase===this.DONE?this.drawAnnotation(this.annotation):this.phase===this.EDITING&&this.drawEdit()}clean(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}bindEvents(){if(this.edit)for(let e in this.events){let t=this.events[e];Array.isArray(t)||(t=[t]),t.forEach(t=>{this.canvas.addEventListener(e,t,!1)})}}unmount(){if(this.edit)for(let e in this.events){let t=this.events[e];Array.isArray(t)||(t=[t]),t.forEach(t=>{this.canvas.removeEventListener(e,t)})}}};var X=class extends Y{getEvents(){return this.onMouseUp=this.onMouseUp.bind(this),{mouseup:this.onMouseUp}}onMouseUp(e){let t=this.visualizer.canvasToPoint(this.getMouseEventPosition(e));this.annotation=this.createAnnotation(t),this.registerAnnotation(this.annotation),this.phase=this.DONE,this.draw()}drawAnnotation(e,t){t=t||{};let a=this.visualizer.pointToCanvas(e),s=t.fillStyle||"yellow",i=t.radius||3;this.ctx.fillStyle=s,this.ctx.fillRect(a.x-i,a.y-i,2*i,2*i)}createAnnotation(e){return{x:(e=this.visualizer.validatePoints(e)).x,y:e.y}}};var J=class extends Y{getEvents(){return this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),{mousedown:this.onMouseDown,mousemove:this.onMouseMove,mouseup:this.onMouseUp}}onMouseDown(e){document.body.style.mozUserSelect=document.body.style.webkitUserSelect=document.body.style.userSelect="none",this.startPoint=this.getMouseEventPosition(e),this.phase=this.EMPTY_ANNOTATOR,this.dragged=!1}onMouseMove(e){this.startPoint&&(this.currentPoint=this.getMouseEventPosition(e),this.draw(),this.dragged=!0,this.phase=this.EDITING)}onMouseUp(e){if(this.dragged){let e=this.visualizer.canvasToPoint(this.startPoint),t=this.visualizer.canvasToPoint(this.currentPoint);this.annotation=this.createAnnotation(e,t),this.registerAnnotation(this.annotation),this.phase=this.DONE,this.draw()}this.startPoint=null,this.currentPoint=null,this.dragged=!1}drawBBox(e,t,a){this.ctx.beginPath();let s=a.dash||[],i=a.color||"yellow",n=a.lineWidth||5;this.ctx.setLineDash(s),this.ctx.rect(e.x,e.y,t.x-e.x,t.y-e.y),this.ctx.strokeStyle=i,this.ctx.lineWidth=n,this.ctx.stroke()}drawAnnotation(e,t){t=t||{};let a=this.createPoint(e.left,e.bottom),s=this.createPoint(e.right,e.top);a=this.visualizer.pointToCanvas(a),s=this.visualizer.pointToCanvas(s),this.drawBBox(a,s,t)}drawEdit(){let e=this.startPoint,t=this.currentPoint;this.drawBBox(e,t,{dash:[10,15],color:"red"})}createAnnotation(e,t){return e=this.visualizer.validatePoints(e),t=this.visualizer.validatePoints(t),{top:Math.max(e.y,t.y),bottom:Math.min(e.y,t.y),left:Math.min(e.x,t.x),right:Math.max(e.x,t.x)}}init(){this.startPoint=null,this.currentPoint=null,this.dragged=!1}},K="/Users/erobredo/Documents/conabio/data_management/annotator-selia/src/lib/Annotator.js";var Z=class extends i.a.Component{constructor(e){super(e),this.state={phase:"list",selectedAnnotation:null,ready:{item:!1,annotationTypes:!1,visualizer:!1,annotators:!1,itemType:!1},info:{itemType:{},item:{},annotationTypes:{}},components:{visualizer:{},annotators:{}}}}render(){return i.a.createElement("div",{className:"container-fluid p-0",__source:{fileName:K,lineNumber:39},__self:this},this.renderTabs(),this.renderContent())}renderTabs(){let e=[["list",i.a.createElement("span",{className:"px-5",__source:{fileName:K,lineNumber:48},__self:this},"Lista ",i.a.createElement("i",{className:"fas fa-list",__source:{fileName:K,lineNumber:48},__self:this}))],["create",i.a.createElement("span",{className:"px-5",__source:{fileName:K,lineNumber:49},__self:this},"Crear ",i.a.createElement("i",{className:"fas fa-plus",__source:{fileName:K,lineNumber:49},__self:this}))]];this.state.selectedAnnotation&&e.push(["detail",i.a.createElement("span",{className:"px-5",__source:{fileName:K,lineNumber:52},__self:this},"Detalle ",i.a.createElement("i",{className:"fas fa-info",__source:{fileName:K,lineNumber:52},__self:this}))]);let t=e.map(([e,t])=>{let a=this.state.phase===e?"light-green nav-link active":"nav-link";return i.a.createElement("li",{className:"nav-item",onClick:()=>this.setState({phase:e}),__source:{fileName:K,lineNumber:59},__self:this},i.a.createElement("div",{className:a,__source:{fileName:K,lineNumber:60},__self:this},t))});return i.a.createElement("ul",{className:"nav nav-tabs pt-2 bg-light justify-content-center",__source:{fileName:K,lineNumber:66},__self:this},t)}renderContent(){if(!this.isReady())return this.renderIsNotReady();switch(this.state.phase){case"list":return i.a.createElement(P,{info:this.state.info,urls:this.props.urls,selectedAnnotation:this.state.selectedAnnotation,components:this.state.components,goToCreate:()=>this.setState({phase:"create"}),selectAnnotation:e=>this.setState({selectedAnnotation:e}),editAnnotation:e=>this.setState({phase:"detail",selectedAnnotation:e}),__source:{fileName:K,lineNumber:80},__self:this});case"create":return i.a.createElement(M,{info:this.state.info,urls:this.props.urls,components:this.state.components,changePhase:()=>this.setState({phase:"list"}),__source:{fileName:K,lineNumber:95},__self:this});case"detail":return i.a.createElement(U,{info:this.state.info,urls:this.props.urls,selectedAnnotation:this.state.selectedAnnotation,components:this.state.components,changePhase:()=>this.setState({phase:"list"}),__source:{fileName:K,lineNumber:104},__self:this});default:return""}}renderIsNotReady(){return i.a.createElement("div",{className:"container-fluid bg-light",__source:{fileName:K,lineNumber:119},__self:this},i.a.createElement("div",{className:"d-flex flex-column",style:{height:"20em"},__source:{fileName:K,lineNumber:120},__self:this},i.a.createElement("div",{className:"d-flex justify-content-center p-4",__source:{fileName:K,lineNumber:121},__self:this},i.a.createElement("div",{className:"spinner-border",style:{height:"10em",width:"10em"},role:"status",__source:{fileName:K,lineNumber:122},__self:this},i.a.createElement("span",{className:"sr-only",__source:{fileName:K,lineNumber:123},__self:this},"Loading..."))),i.a.createElement("div",{className:"text-muted w-100 text-center",__source:{fileName:K,lineNumber:126},__self:this},"Porfavor espera en lo que cargamos la informaciÃ³n")))}getAnnotationTypesInfo(){let e=this.props.urls.annotation_types+"?page_size=99";fetch(e).then(e=>e.json()).then(e=>{this.setState(t=>(t.info.annotationTypes=e.results,t.ready.annotationTypes=!0,t))})}getItemInfo(){let e=this.props.urls.item;return fetch(e).then(e=>e.json()).then(e=>{this.setState(t=>(t.info.item=e,t.ready.item=!0,t))})}getItemTypeInfo(){let e=this.props.urls.item_type;fetch(e).then(e=>e.json()).then(e=>{this.setState(t=>(t.info.itemType=e,t.ready.itemType=!0,t))})}getVisualizer(){this.setState(e=>(e.components.visualizer=W,e.ready.visualizer=!0,e))}getAnnotationTools(){this.setState(e=>(e.components.annotators={"Bounding Box":J,Punto:X},e.ready.annotators=!0,e))}componentDidMount(){this.getItemTypeInfo(),this.getItemInfo(),this.getAnnotationTypesInfo(),this.getVisualizer(),this.getAnnotationTools()}isReady(){for(let e in this.state.ready)if(!this.state.ready[e])return!1;return!0}};t.default=Z}]);